<html xmlns:th="http://www.thymeleaf.org">

<div th:fragment="sourceList(sources, link)">
    <h3 class="mt-5">Sources</h3>
    <div class="row">
        <div class="col-md-8">

            <table id="sources-table" class="table table-striped table-responsive-md">
                <thead>
                <tr>
                    <th>Source</th>
                    <th>Link</th>
                    <th>Description</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="src : ${sources}">
                    <td th:id="${src.srcEntityId}"/>
                    <td th:id="${src.link}"/>
                    <td th:text="${src.description}"/>
                </tr>
                </tbody>
            </table>

            <th:block th:if="${#authorization.expression('hasRole(''ROLE_USER'')')} and not ${#strings.isEmpty(link)}">
                <div th:replace="fragments/src-ref-form :: sourceForm(${link})"></div>
            </th:block>
        </div>
        <script>
            sourcesCallbacks.push(function() {
                if ($('#sources-table tr').length > 0) {
                    $('tbody tr td:nth-child(1)').val(function(){
                        var source = sources[$(this).attr('id')];
                        if (source) {
                            $(this).append('<a href="/source/details/' + source.id + '">' + source.name + '</a>')
                        }
                    });
                    $('tbody tr td:nth-child(2)').val(function(){
                        if ($(this).attr('id')) {
                            $(this).append('<a href="' + $(this).attr('id') +
                                 '" target="_blank" class="btn btn-primary fas fa-link"/>')
                        }
                    });
                }
            });
        </script>
    </div>
</div>
</html>