<html xmlns:th="http://www.thymeleaf.org">

    <div th:fragment="reviewForm(action_path, review)">
        <form th:id="'rev_form_' + ${review.id}" th:action="${action_path}" th:object="${review}" method="post">
            <input type="text" class="d-none" name="ownerId" th:value="${review.ownerId} ? ${review.ownerId} : ${#authentication.principal.name}" readonly/>
            <div class="row">
                <div class="col-4">
                    <label th:for="'rating' + *{id}" class="col-form-label">Reliability</label>
                    <input type="number" name="rating" th:value="*{rating}" min="0" max="1" step="0.01"
                           class="form-control" th:id="'rating' + *{id}" placeholder="0.9"/>
                    <span th:if="${#fields.hasErrors('rating')}" th:errors="*{rating}" class="text-danger"></span>
                </div>
                <div class="col-8">
                    <label th:for="'comment' + *{id}" class="col-form-label">Comment</label>
                    <textarea name="comment" th:text="*{comment}" class="form-control" th:id="'comment' + *{id}" cols="30"
                              placeholder="Explain your review..."></textarea>
                    <span th:if="${#fields.hasErrors('comment')}" th:errors="*{comment}" class="text-danger"></span>
                </div>

            </div>
            <div th:if="${#authorization.expression('hasRole(''ROLE_CHECKER'')')}" class="row mt-2">
                <div class="col-4">
                    <input type="submit" th:id="'rev_form_submit_' + ${review.id}" class="btn btn-primary"
                       th:data-modal-selector="'#modal_rev_form_' + ${review.id}"
                       th:data-form-selector="'#rev_form_' + ${review.id}"
                       th:data-action_path="${action_path}"
                           value="Submit">
                    </a>
                </div>
            </div>
            <th:block th:if="${#fields.hasAnyErrors()}">
                <!-- Display form if submission failed with errors -->
                <script>
                    loadCompleteCallbacks.push(function() {
                        const form_selector = "#rev_form_" + "[[${review.id}]]";
                        // trigger containing modal to display form
                        const modal_selector = "#" + $(form_selector).closest(".modal").attr("id");
                        $("button[data-bs-target='"+ modal_selector +"']").click();
                    });
                </script>
            </th:block>
        </form>
    </div>
</html>