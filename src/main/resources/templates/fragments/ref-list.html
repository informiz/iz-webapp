<html xmlns:th="http://www.thymeleaf.org">

<div th:fragment="referenceList(references, link)">
    <h3 class="mt-5">References</h3>
    <div class="row">
        <div class="col-md-8">

            <table id="references-table" class="table table-striped table-responsive-md">
                <thead>
                <tr>
                    <th>Reference</th>
                    <th>Score</th>
                    <th>Entailment</th>
                    <th>Comment</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="ref : ${references}">
                    <td th:id="${ref.citationId}"/>
                    <td th:name="@{score_{id}(id=${ref.citationId})}"/>
                    <td th:text="${ref.entailment.displayValue}"></td>
                    <td th:text="${ref.comment}"></td>
                </tr>
                </tbody>
            </table>

            <th:block th:if="${#authorization.expression('hasRole(''ROLE_USER'')')} and not ${#strings.isEmpty(link)}">
                <div th:replace="fragments/reference-form :: referenceForm(${link})"></div>
            </th:block>
        </div>
        <script>
            citationsCallbacks.push(function() {
                if ($('#references-table tr').length > 0) {
                    $('#references-table td[id]').val(function(){
                        var id = $(this).attr('id');
                        var ref = citations[id];
                        if (ref) {
                            $(this).append('<a href = "/citation/view/' + ref.id + '">' + ref.text + '</a>')
                            var selector = "td[name='score_"  + id + "']";
                            $(selector).text(ref.score.reliability);
                        }
                    });
                }
            });
            claimsCallbacks.push(function() {
                if ($('#references-table tr').length > 0) {
                    $('#references-table td[id]').val(function(){
                        var id = $(this).attr('id');
                        var ref = claims[id];
                        if (ref) {
                            $(this).append('<a href = "/hypothesis/view/' + ref.id + '">' + ref.claim + '</a>')
                            var selector = "td[name='score_"  + id + "']";
                            $(selector).text(ref.score.reliability);
                        }
                    });
                }
            });
        </script>
    </div>
</div>
</html>